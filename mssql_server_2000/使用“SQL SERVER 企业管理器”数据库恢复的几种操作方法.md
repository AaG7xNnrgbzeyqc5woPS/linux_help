
-《使用“SQL SERVER 企业管理器”数据库恢复的几种操作方法》

# 1. 背景
最近在不同的服务器上，使用备份的数据库进行数据库的恢复出现一点麻烦。
总是容易出现各种错误，文件正在使用，不能覆盖什么的。
现在总结下各种备份恢复方法的优缺点，选取最优的最可靠的方案

# 2. 备份
- 2.1 使用企业管理器可以将一个数据库备份出来，可以先建立备份设备，直接备份到备份设备上，为了便于传递数据，也可以使用备份到一个文件上。目前我就掌握这两种方法。
- 2.2 备份到设备的时候，需要先建立备份设备，在备份的时候可以选择这个备份设备。优点，备份设备由 企业管理器管理，方便查看管理。
- 2.3 备份到 文件，可以指定新文件，也可以在老的备份文件上添加新的备份。一般我们用新文件，一个文件就一个备份集合。
- 2.4 ❤️注意：备份到空白文件，这是我们下面恢复的前提假设，其它的情况不讨论。

# 3. 恢复方法总结：
## 3.1 恢复的方法分三种：
### 3.1.1 方法一：使用单备份集的备份文件A，恢复到指定数据库B上
  - 数据库B是正在使用的数据库，里面有用户定义的数据库对象，还有用户数据。
  - 这种情况显然限制最多，备份文件A必须是 原来数据库B的备份，也必须是本机上的备份，总之限制很多，否则会失败，这是为了避免破坏现有的数据库。
  - 以上是我目前的肤浅认识，最近没有看文档，也没有做过实验。
### 3.1.2 方法二： 使用备份文件A，恢复到新建空白数据库C上
  - 这个方法同 方法一基本类似，只是在恢复前先建立一个空白数据库C，然后使用方法一，将备份文件A恢复到数据库C上
  - 显然《企业管理器》对这个限制应该会稍微少一点，因为这是个新建立的数据库，没有什么用户数据。

### 3.1.3 方法三：使用备份文件A，在恢复操作的时候，填上新的数据库名D
  - 因为这个方法在开始的时候，没有建立任何数据库，直接指定一个全新的数据库名称，《企业管理器》在恢复操作的时候，完全知道这是一个新的数据库D，所以它最容易操作正确
  - 这个方法已经经过实际检验，不同的电脑上，不同的备份文件，不同的人操作，包括一个备份文件多次恢复，成不同的几个数据库，完全都没有问题。
  - 💝 推荐尽量使用这个方法恢复数据库，两步并做一步，简单高效。

# 4. 方法三的具体操作步骤
  - 打开《SQL SERVER 企业管理器》，选择对应的服务器，再选择”数据库“，在此处点右键，打开右键菜单
  - 在菜单中选择 ”\所有任务\还原数据库“，这个时候打开还原数据库对话框，Title是 “还原数据库”
  - ❗ 请注意：还原为数据库这一栏为目标数据库，当前是服务器的第一个数据库，这不是我们需要的。我们需要直接修改数据库名为新的数据名称，这个编辑框是可以修改的！
  - 下一步，选择“还原：从设备“， 表示数据来源 是一个设备。
  - 再下一步，点击“选择设备”，这时候会出现一个新的对话窗口。
  - 还原自磁盘，这是缺省的，不用修改，再点“添加”，又弹出一个对话窗口，
  - 文件名项目，点后面的三个点的按钮，弹出一个新的窗口，选择文件
  - 💔 注意一：SQL Server 企业管理器，不能识别网络硬盘，对virtual box的共享硬盘能够识别，但是支持不好，操作会失败。所以要将备份文件A，拷贝到 虚拟机内的硬盘上，比如硬盘C：
  - 注意二：恢复完数据库后，记得更改注册表，使得应用程序能够访问到正确的数据库


